(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f9e077ee"],{"504d":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cont"},[a("div",{staticClass:"header"},["addExam"===e.action?a("h2",{staticClass:"text-center"},[e._v("أضافة أمتحان")]):e._e(),"editExam"===e.action?a("h2",{staticClass:"text-center"},[e._v("تعديل الأمتحان")]):e._e(),"editExam"===e.action?a("h5",{staticClass:"text-center"},[e._v(e._s(e.exam.number))]):e._e(),a("hr")]),a("div",{staticClass:"settings"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-4"},[a("div",{staticClass:"examinfo"},[a("label",[e._v("أسم الامتحان")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.exam.name,expression:"exam.name"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.exam.name},on:{input:function(t){t.target.composing||e.$set(e.exam,"name",t.target.value)}}})])]),"addExam"===e.action||"saved"===e.action?a("div",{staticClass:"col-md-4"},[a("div",{staticClass:"examinfo"},[a("label",[e._v("رقم الامتحان")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.exam.number,expression:"exam.number",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"number"},domProps:{value:e.exam.number},on:{input:function(t){t.target.composing||e.$set(e.exam,"number",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]):e._e(),a("div",{staticClass:"col-md-4"},[a("div",{staticClass:"examinfo form-text"},[a("label",{attrs:{for:"stage"}},[e._v("السنة الدراسية")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.exam.year,expression:"exam.year",modifiers:{number:!0}}],staticClass:"form-control",attrs:{id:"stage",min:"2020",type:"number"},domProps:{value:e.exam.year},on:{input:function(t){t.target.composing||e.$set(e.exam,"year",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}}),a("span",[e._v("/"+e._s(e.exam.year+1))])])]),a("div",{staticClass:"col-md-4"},[a("div",{staticClass:"examinfo"},[a("label",[e._v("المرحلة الدراسية")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.exam.stage,expression:"exam.stage"}],staticClass:"form-control",on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.exam,"stage",t.target.multiple?a:a[0])},e.getUnits]}},[a("option",{attrs:{selected:"",value:"1"}},[e._v("الصف الأول الاعدادي")]),a("option",{attrs:{selected:"",value:"2"}},[e._v("الصف الثاني الاعدادي")]),a("option",{attrs:{selected:"",value:"3"}},[e._v("الصف الثالث الاعدادي")]),a("option",{attrs:{selected:"",value:"4"}},[e._v("الصف الأول الثانوي")]),a("option",{attrs:{selected:"",value:"5"}},[e._v("الصف الثاني الثانوي")]),a("option",{attrs:{selected:"",value:"6"}},[e._v("الصف الثالث الثانوي")])])])]),a("div",{staticClass:"col-md-4"},[a("div",{staticClass:"examinfo"},[a("label",[e._v("الوحدة")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.exam.unit,expression:"exam.unit"}],staticClass:"form-control",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.exam,"unit",t.target.multiple?a:a[0])}}},e._l(e.units,(function(t){return a("option",{key:t.number,attrs:{selected:""},domProps:{value:t.number}},[e._v(" "+e._s(t.name)+" ")])})),0)])]),a("div",{staticClass:"nos col-md-4"},[a("div",{staticClass:"examinfo"},[a("label",[e._v("مدة الأمتحان")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.exam.timer,expression:"exam.timer",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"number",min:"1"},domProps:{value:e.exam.timer},on:{input:function(t){t.target.composing||e.$set(e.exam,"timer",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),a("div",{staticClass:"col-md-4"},[a("div",{staticClass:"examinfo"},[a("div",{staticClass:"md-form"},[a("label",[e._v("تاريخ انتهاء الامتحان")]),a("datetime",{staticClass:"form-control",attrs:{type:"datetime",placeholder:"اختار تاريخ انتهاء صلاحية الامتحان","use12-hour":""},model:{value:e.exam.deadLine,callback:function(t){e.$set(e.exam,"deadLine",t)},expression:"exam.deadLine"}})],1)])]),a("div",{staticClass:"col-md-4"},[a("div",{staticClass:"examinfo"},[a("label",[e._v("تاريخ النشر")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.exam.publishDate,expression:"exam.publishDate"}],staticClass:"form-control",attrs:{type:"date"},domProps:{value:e.exam.publishDate},on:{input:function(t){t.target.composing||e.$set(e.exam,"publishDate",t.target.value)}}})])])]),a("hr"),a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"nos col-md-4"},[a("div",{staticClass:"examinfo"},[a("label",[e._v("عدد الاسئلة الرئيسية")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.numberOfQuestionsSections,expression:"numberOfQuestionsSections",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"number",min:"1",max:"10"},domProps:{value:e.numberOfQuestionsSections},on:{input:function(t){t.target.composing||(e.numberOfQuestionsSections=e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),a("div",{staticClass:"col-md-4"},[a("label",[e._v("PDF")]),a("input",{ref:"pdf",staticClass:"form-control",attrs:{type:"file"},on:{change:e.pickPdf}}),a("label",[a("a",{attrs:{href:e.pdfName}},[e._v(e._s(e.pdfName))])])])])]),a("div",{staticClass:"questions"},[a("div",{staticClass:"questionsSection"},e._l(e.exam.sections,(function(t,s){return a("questions-section",{key:s,attrs:{section:t,index:s},on:{concatArraysOfQuestions:e.concatArraysOfQuestionsHandler}})})),1)]),e.loading?a("loading"):e._e(),e.removing?a("loading"):e._e(),a("div",{staticClass:"row justify-content-center align-items-center"},[a("div",{staticClass:"actions col-md-4"},[a("button",{staticClass:"btn",on:{click:e.addExam}},[e._v("اضافة الامتحان")])]),e.examExist?a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"btn btn-success",on:{click:e.gotoSolutionModel}},[e._v(" اضافة نموذج اجابة ")])]):e._e(),a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"_btn btn-1",attrs:{disabled:!e.questionsExist},on:{click:e.copyQuestions}},[e._v(" Copy ")])]),a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"_btn btn-2",attrs:{disabled:!e.questionsStorageExist},on:{click:e.pasteQuestions}},[e._v(" Paste ")])]),a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"_btn btn-3",attrs:{disabled:!e.questionsExist},on:{click:e.download}},[e._v(" Download ")])]),a("div",{staticClass:"col-md-4"},[a("input",{ref:"upload",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:e.getJson}}),a("button",{staticClass:"_btn btn-4",on:{click:e.upload}},[e._v("Upload")])]),a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"_btn btn-danger",on:{click:e.removeQuestions}},[e._v("Remove")])])])],1)},n=[],i=(a("99af"),a("4de4"),a("caad"),a("fb6a"),a("b0c0"),a("d3b7"),a("ac1f"),a("25f0"),a("2532"),a("3ca3"),a("1276"),a("159b"),a("ddb0"),a("2b3d"),a("b85c")),o=(a("96cf"),a("1da1")),r=a("5530"),c=a("bc3a"),u=a.n(c),l=a("25d0"),m=a("c428"),d=a("56d7"),f=a("859b"),v=(a("9f21"),{created:function(){var e=this;if(this.$route.params.id)this.action="editExam",this.fetchAPI="/fetchUnitExamById/"+this.$route.params.id,this.examId=this.$route.params.id;else{if(this.action="addExam",localStorage.getItem("exam"))return this.exam=JSON.parse(localStorage.getItem("exam")),this.numberOfQuestionsSections=this.exam.sections.length;setTimeout((function(){e.numberOfQuestionsSections=1}),200)}"editExam"==this.action&&(localStorage.removeItem("exam"),u.a.get(this.fetchAPI).then((function(t){t.data.exam?(e.exam=t.data.exam,e.pdfName=t.data.exam.pdf,e.numberOfQuestionsSections=t.data.exam.sections.length,e.examExist=!0):setTimeout((function(){e.numberOfQuestionsSections=1}),200)}))),this.getUnits()},mounted:function(){var e=this;"addExam"==this.action&&(this.intervalSave=setInterval((function(){return e.saveProgress()}),3e3))},destroyed:function(){this.intervalSave&&clearInterval(this.intervalSave)},components:{QuestionsSection:l["a"],Loading:m["a"],Datetime:f["Datetime"]},data:function(){return{exam:{name:"",number:"",year:2022,stage:"6",unit:"1",deadLine:new Date((new Date).getTime()+6048e5).toISOString().substring(0,10),publishDate:(new Date).toISOString().substring(0,10),timer:5,sections:[],pdf:null},loading:!1,removing:!1,numberOfQuestionsSections:0,allQuestions:[],action:"addExam",fetchAPI:"",uploadAPI:"/uploadUnitExam",examId:null,examExist:!1,units:[],file:null,internalSave:null,pdfName:null}},computed:{questionsExist:function(){return!0},questionsStorageExist:function(){return!0}},watch:{numberOfQuestionsSections:function(e){for(var t=0,a=Object(r["a"])({},this.exam),s=0;s<e;s++)this.exam.sections[s]=a.sections[s]||{},t++;this.exam.sections=this.exam.sections.slice(0,t)}},methods:{concatArraysOfQuestionsHandler:function(e,t){this.allQuestions[t]=e},saveProgress:function(){d["eventBus"].$emit("save");var e=Object(r["a"])(Object(r["a"])({},this.exam),{},{sections:this.allQuestions});localStorage.setItem("exam",JSON.stringify(e))},addExam:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.allQuestions=[],d["eventBus"].$emit("collectQuestions"),console.log(e.validate()),e.validate()){t.next=5;break}return t.abrupt("return");case 5:return t.next=7,e.createExamFormData();case 7:a=t.sent,e.loading=!0,u.a.post(e.uploadAPI,a).then((function(t){if(e.allQuestions=[],e.loading=!1,t.data.err)return e.examExist=!1,void e.$store.dispatch("writemessage",t.data.err);e.examExist=!0,t.data.id&&(e.examId=t.data.id),e.$store.dispatch("writemessage","تم رفع الامتحان بنجاح"),localStorage.removeItem("exam")}));case 10:case"end":return t.stop()}}),t)})))()},newExam:function(){var e=this;this.action="addExam",this.numberOfQuestionsSections=0,setTimeout((function(){e.numberOfQuestionsSections=1}),200),this.exam={stage:"6",number:1,year:2021,publishDate:(new Date).toISOString().substring(0,10),timer:5,deadLine:new Date((new Date).getTime()+6048e3).toISOString().substring(0,10),sections:[]}},createExamFormData:function(){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function t(){var a,s,n,o,c,u,l,m,d,f,v,p,b,x,h,g,_,y,C;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:a=new FormData,s=Object(r["a"])({},e.exam),delete s["sections"],delete s["fullDegree"],t.t0=regeneratorRuntime.keys(s);case 5:if((t.t1=t.t0()).done){t.next=13;break}if(n=t.t1.value,"pdf"!=n||!s[n]||"string"==typeof s[n]){t.next=10;break}return a.append(n,s[n],(new Date).getTime().toString()),t.abrupt("continue",5);case 10:a.append(n,s[n]),t.next=5;break;case 13:o=0,c=[],u=Object(i["a"])(e.allQuestions),t.prev=16,u.s();case 18:if((l=u.n()).done){t.next=59;break}if(m=l.value,c.push(m),!m.type.includes("blob:")){t.next=31;break}return d="address-".concat(m.number),t.next=25,fetch(m.type);case 25:return f=t.sent,t.next=28,f.blob();case 28:v=t.sent,p=new File([v],"".concat(d,".").concat(m.mimetype.split("/")[1]),{type:m.mimetype}),a.append("image",p,d);case 31:b=Object(i["a"])(m.questions),t.prev=32,b.s();case 34:if((x=b.n()).done){t.next=49;break}if(h=x.value,o+=h.fullDegree,!h.question.includes("blob:")){t.next=47;break}return g="question-".concat(m.number,"-").concat(h.number,"-").concat((new Date).getTime()),t.next=41,fetch(h.question);case 41:return _=t.sent,t.next=44,_.blob();case 44:y=t.sent,C=new File([y],"".concat(g,".").concat(h.mimetype.split("/")[1]),{type:h.mimetype}),a.append("image",C,g);case 47:t.next=34;break;case 49:t.next=54;break;case 51:t.prev=51,t.t2=t["catch"](32),b.e(t.t2);case 54:return t.prev=54,b.f(),t.finish(54);case 57:t.next=18;break;case 59:t.next=64;break;case 61:t.prev=61,t.t3=t["catch"](16),u.e(t.t3);case 64:return t.prev=64,u.f(),t.finish(64);case 67:return a.append("fullDegree",o),a.append("sections",JSON.stringify(c)),t.abrupt("return",a);case 70:case"end":return t.stop()}}),t,null,[[16,61,64,67],[32,51,54,57]])})))()},gotoSolutionModel:function(){this.examExist&&this.$router.push("/dashboard/unit-exam-solutionModel/"+this.examId)},getUnits:function(){var e=this;this.units=this.$store.getters.sections.filter((function(t){return t.stage==e.exam.stage}))},validate:function(){var e=[];return""==this.exam.name&&e.push("لم تضع أسم الأمتحان"),""==this.exam.number&&e.push("لم تضع رقم الأمتحان"),0==this.exam.timer&&e.push("لم تضع مدة الامتحان"),"addExam"==this.action&&""==this.exam.number&&e.push("لم تضع رقم الامتحان"),new Date(this.exam.deadLine).getTime()<(new Date).getTime()&&e.push("تاريخ صلاحية الامتحان في تاريخ سابق"),this.allQuestions.forEach((function(t){""==t.type&&e.push("عنوان القسم رقم ".concat(t.number+1," غير موجود")),t.questions.forEach((function(a,s){""==a.question&&e.push("السؤال رقم ".concat(s+1," في القسم رقم ").concat(t.number+1," غير موجود")),""==a.fullDegree&&e.push("درجة السؤال رقم ".concat(s+1," في القسم رقم ").concat(t.number+1," غير موجودة")),a.choices.length<2&&e.push("عدد الأختيارات في السؤال رقم ".concat(s+1," القسم رقم  ").concat(t.number+1," أقل من أختيارين")),a.choices.forEach((function(a,n){""==a&&e.push("الاختيار رقم ".concat(n+1," في السؤال رقم ").concat(s+1," في القسم رقم ").concat(t.number+1," غير موجود"))}))}))})),e.length>0?(e.forEach((function(e){alert(e)})),!1):(console.log(e),!0)},copyQuestions:function(){d["eventBus"].$emit("collectQuestions"),localStorage.setItem("questions",JSON.stringify(this.allQuestions)),this.$store.dispatch("writemessage","تم نسخ الأمتحان")},pasteQuestions:function(){var e=JSON.parse(localStorage.getItem("questions"));e&&(this.exam=Object(r["a"])(Object(r["a"])({},this.exam),{},{sections:e}),this.numberOfQuestionsSections=e.length)},download:function(){d["eventBus"].$emit("collectQuestions");var e=JSON.stringify(this.allQuestions),t=new Blob([e],{type:"octet/stream"}),a=window.URL.createObjectURL(t),s=document.createElement("a");s.download=this.exam.name+".json",s.href=a,s.click(),window.URL.revokeObjectURL(a)},getJson:function(e){var t=this,a=e.target.files[0];if("json"!=a.type.split("/")[1])return alert("ملفات json فقط مسمحوحة");this.file=a;var s=new Blob([a],{type:"octet/stream"}),n=new FileReader;n.readAsText(s),n.addEventListener("loadend",(function(e){var a=JSON.parse(e.srcElement.result);a&&(t.exam=Object(r["a"])(Object(r["a"])({},t.exam),{},{sections:a}),t.numberOfQuestionsSections=a.length)}))},upload:function(){this.$refs.upload.click()},removeQuestions:function(){var e=this;confirm("تأكيد مسح الأسئلة")&&(this.exam.sections=[],this.numberOfQuestionsSections=0,setTimeout((function(){return e.numberOfQuestionsSections=1}),400),localStorage.removeItem("exam"))},pickPdf:function(e){var t=e.target.files[0];return"pdf"!=t.type.split("/")[1]?alert("only PDF files allowed"):t.size>1e7?alert("file exceeds size limit"):(this.exam.pdf=t,void(this.pdfName=t.name))}}}),p=v,b=(a("6653"),a("2877")),x=Object(b["a"])(p,s,n,!1,null,"70f1efaf",null);t["default"]=x.exports},6653:function(e,t,a){"use strict";a("fe8e")},"9f21":function(e,t,a){"use strict";a.d(t,"c",(function(){return n})),a.d(t,"b",(function(){return i})),a.d(t,"a",(function(){return o}));a("99af"),a("7db0"),a("caad"),a("a15b"),a("d81d"),a("b0c0"),a("2909");var s=a("4360"),n=function(e){var t="";switch(e){case"1":t="الصف الأول الاعدادي";break;case"2":t="الصف الثاني الاعدادي";break;case"3":t="الصف الثالث الاعدادي";break;case"4":t="الصف الأول الثانوي";break;case"5":t="الصف الثاني الثانوي";break;case"6":t="الصف الثالث الثانوي";break}return t},i=function(e,t){var a=s["a"].getters.sections.find((function(a){return a.number==e&&a.stage==t}));return a?a.name:e},o=function(e){var t=e.sections.map((function(e){return{type:e.type,questions:e.questions.map((function(e){return{question:e.question,choices:e.choices,answer:"",degree:0,fullDegree:e.fullDegree,correction:""}}))}}));return t}},fe8e:function(e,t,a){}}]);
//# sourceMappingURL=chunk-f9e077ee.9bac73f1.js.map