(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1dab0d62","chunk-404a5b50"],{"0667":function(e,t,a){"use strict";a("a89b")},1148:function(e,t,a){"use strict";var s=a("a691"),i=a("1d80");e.exports="".repeat||function(e){var t=String(i(this)),a="",n=s(e);if(n<0||n==1/0)throw RangeError("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(t+=t))1&n&&(a+=t);return a}},"408a":function(e,t,a){var s=a("c6b6");e.exports=function(e){if("number"!=typeof e&&"Number"!=s(e))throw TypeError("Incorrect invocation");return+e}},"55b0":function(e,t,a){},"5c3c":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"cont py-5"},[a("div",{staticClass:"video-upload"},[!0===e.edit?a("div",{staticClass:"text-center title"},[e._v("تعديل معلومات الدرس")]):e._e(),!1===e.edit?a("div",{staticClass:"text-center title"},[e._v("انشاء درس جديد")]):e._e(),a("div",{staticClass:"form py-5"},[a("div",{staticClass:"fields row"},[a("div",{staticClass:"col-md-6"},[a("div",{staticClass:"field"},[a("label",[e._v("المرحلة الدراسية")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.lessonData.stage,expression:"lessonData.stage"}],staticClass:"form-control",on:{change:[function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.lessonData,"stage",t.target.multiple?a:a[0])},e.getSections]}},[a("option",{attrs:{selected:"",value:"1"}},[e._v("الصف الأول الاعدادي")]),a("option",{attrs:{selected:"",value:"2"}},[e._v("الصف الثاني الاعدادي")]),a("option",{attrs:{selected:"",value:"3"}},[e._v("الصف الثالث الاعدادي")]),a("option",{attrs:{selected:"",value:"4"}},[e._v("الصف الأول الثانوي")]),a("option",{attrs:{selected:"",value:"5"}},[e._v("الصف الثاني الثانوي")]),a("option",{attrs:{selected:"",value:"6"}},[e._v("الصف الثالث الثانوي")])])])]),a("div",{staticClass:"col-md-6"},[a("div",{staticClass:"field"},[a("label",[e._v("الدورة")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.lessonData.section,expression:"lessonData.section"}],staticClass:"form-control",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.lessonData,"section",t.target.multiple?a:a[0])}}},e._l(e.sections,(function(t){return a("option",{key:t._id,domProps:{value:t.number}},[e._v(" "+e._s(t.name)+" ")])})),0)])]),a("div",{staticClass:"col-md-6"},[a("div",{staticClass:"field"},[a("label",[e._v("مدفوع أم مجاني")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.lessonData.paid,expression:"lessonData.paid"}],staticClass:"form-control",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.lessonData,"paid",t.target.multiple?a:a[0])}}},[a("option",{domProps:{value:!1}},[e._v("Free")]),a("option",{domProps:{value:!0}},[e._v("Paid")])])])]),a("div",{staticClass:"col-md-6"},[a("div",{staticClass:"field"},[a("label",[e._v("رقم الدرس")]),a("input",{directives:[{name:"model",rawName:"v-model.number",value:e.lessonData.number,expression:"lessonData.number",modifiers:{number:!0}}],staticClass:"form-control",attrs:{type:"number",min:"1",placeholder:"رقم الدرس"},domProps:{value:e.lessonData.number},on:{input:function(t){t.target.composing||e.$set(e.lessonData,"number",e._n(t.target.value))},blur:function(t){return e.$forceUpdate()}}})])]),a("div",{staticClass:"field col-md-12"},[a("label",[e._v("عنوان الدرس")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.lessonData.name,expression:"lessonData.name"}],staticClass:"form-control",attrs:{type:"text",placeholder:"عنوان الدرس"},domProps:{value:e.lessonData.name},on:{input:function(t){t.target.composing||e.$set(e.lessonData,"name",t.target.value)}}})]),a("div",{staticClass:"field col-md-12"},[a("label",[e._v("تاريخ عرض الدرس")]),a("input",{directives:[{name:"model",rawName:"v-model",value:e.lessonData.showDate,expression:"lessonData.showDate"}],staticClass:"form-control",attrs:{type:"date",placeholder:"تاريخ عرض الدرس"},domProps:{value:e.lessonData.showDate},on:{input:function(t){t.target.composing||e.$set(e.lessonData,"showDate",t.target.value)}}})]),a("div",{staticClass:"field col-md-12"},[a("label",[e._v("الشرح")]),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.lessonData.explain,expression:"lessonData.explain"}],staticClass:"form-control",attrs:{type:"text"},domProps:{value:e.lessonData.explain},on:{input:function(t){t.target.composing||e.$set(e.lessonData,"explain",t.target.value)}}})]),a("div",{staticClass:"field col-md-12"},[a("label",[e._v("الملف المرفق")]),a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-6 icon_btn"},[a("label",[e._v("ارفع ملف")]),a("input",{ref:"file",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:e.getFile}}),a("div",{staticClass:"pick",on:{click:function(t){return e.$refs.file.click()}}},[a("i",{staticClass:"fa fa-upload"})])]),e.file.includes("http")?a("div",{staticClass:"col-md-6 icon_btn"},[a("label",[e._v("حمل الملف")]),a("a",{ref:"download",staticStyle:{display:"none"},attrs:{type:"file"},on:{click:function(t){return e.downloadFile(e.id)}}},[e._v("download")]),a("div",{staticClass:"pick",on:{click:function(t){return e.$refs.download.click()}}},[a("i",{staticClass:"fa fa-download",staticStyle:{color:"#000"}})])]):e._e(),a("div",{staticClass:"col-md-12"},[e._v(" "+e._s(e.file)+" "),e.file&&""!=e.file?a("h5",{staticStyle:{background:"#222",padding:"5px","text-align":"center",color:"#fff"}},[e._v(" "+e._s(e.filesName)+" ")]):e._e()])])]),a("div",{staticClass:"field col-md-12"},[a("label",[e._v("نوع الفيديو")]),a("select",{directives:[{name:"model",rawName:"v-model",value:e.method,expression:"method"}],staticClass:"form-control",on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.method=t.target.multiple?a:a[0]}}},[a("option",{attrs:{value:"embedded"}},[e._v("رابط يوتيوب مدمج")])])])]),"upload"==e.method?a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("stream-upload-video",{attrs:{fileName:e.filesName,lessonData:e.lessonData},on:{uploaded:e.handleVideoFileUpload}})],1),"uploaded"==e.videoType?a("div",{staticClass:"preview col-md-12"},[a("video",{attrs:{height:"100%",width:"100%",id:"video",src:e.url+"/bufferVideo/"+e.lessonData.video,frameborder:"3",allow:"autoplay;",allowfullscreen:"",controls:""}})]):e._e()]):e._e(),e.loading&&0===e.progress?a("loading",{attrs:{color:"#fff"}}):e._e(),"embedded"==e.method?a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"field upload2 col-md-12"},[a("label",[e._v("رابط اليوتيوب العادي")]),"embedded"===e.method?a("input",{directives:[{name:"model",rawName:"v-model",value:e.ytUrl,expression:"ytUrl"}],staticClass:"form-control",attrs:{type:"text",placeholder:"ضع رابط يوتويب هنا"},domProps:{value:e.ytUrl},on:{input:function(t){t.target.composing||(e.ytUrl=t.target.value)}}}):e._e()]),a("div",{staticClass:"field upload2 col-md-12"},[a("label",[e._v("رابط اليوتيوب المدمج")]),"embedded"===e.method?a("input",{directives:[{name:"model",rawName:"v-model",value:e.video,expression:"video"}],staticClass:"form-control",attrs:{type:"text",placeholder:"ضع رابط يوتويب المدمج هنا"},domProps:{value:e.video},on:{input:function(t){t.target.composing||(e.video=t.target.value)}}}):e._e()]),"embedded"==e.videoType?a("div",{staticClass:"preview col-md-12"},[a("iframe",{attrs:{width:"100%",height:"300px",src:e.lessonData.video}})]):e._e(),e.loading||e.progress?a("div",{staticClass:"col-md-12"},[e.progress>0?a("div",{staticClass:"progress"},[a("div",{staticClass:"progressbar",style:{width:e.progress+"%"}},[e._v(" "+e._s(e.progress)+"% ")])]):e._e()]):e._e()]):e._e(),a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"btn btn-danger",on:{click:e.uploadVideo}},[e._v("Upload video")])]),e.id?a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"btn btn-primary",on:{click:function(t){return e.$router.push("/dashboard/addTask/"+e.id)}}},[e._v(" الواجب ")])]):e._e()])],1)])])},i=[],n=(a("99af"),a("caad"),a("b0c0"),a("ac1f"),a("2532"),a("1276"),a("96cf"),a("1da1")),o=a("bc3a"),l=a.n(o),r=a("c428"),d=a("bd80"),c=(a("56d7"),{components:{Loading:r["a"],StreamUploadVideo:d["default"]},created:function(){var e=this,t=this.$route.params;t.id&&(this.id=t.id,l.a.get("/fetchVideo/"+t.id).then(function(){var t=Object(n["a"])(regeneratorRuntime.mark((function t(a){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.lessonData=a.data.video,e.video=a.data.video.videoPath,e.file=a.data.video.filePath,a.data.video.videoPath.includes("embed")?e.method="embedded":e.method="upload",e.edit=!0,e.getSections();case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),localStorage.getItem("chunks")&&(this.method="upload")},data:function(){return{lessonData:{number:1,name:null,stage:"3",explain:null,section:null,paid:!1,video:null,file:"",showDate:""},id:null,edit:!1,progress:0,method:"embedded",loading:!1,sections:[],url:l.a.defaults.baseURL,video:null,file:"",ytUrl:""}},computed:{formData:function(){var e=new FormData;return e.append("number",this.lessonData.number),e.append("name",this.lessonData.name),e.append("stage",this.lessonData.stage),e.append("video",this.lessonData.video),e.append("date",new Date),e.append("showDate",this.lessonData.showDate),e.append("file",this.lessonData.file),e.append("explain",this.lessonData.explain),e.append("section",this.lessonData.section),e.append("paid",this.lessonData.paid),e.append("fileName",this.lessonData.filesName),e},filesName:function(){return"".concat(this.lessonData.section,"_").concat(this.lessonData.name,"_").concat(this.lessonData.number,"_").concat(this.lessonData.stage)},fileName:function(){return this.file||""},videoType:function(){return this.video?this.video.includes("embed")?"embedded":this.video.includes("http")?null:"uploaded":null}},watch:{video:function(e){this.lessonData.video=e},ytUrl:function(e){var t=e.split("v=")[1];if(e.includes("shorts")){var a=e.split("/"),s=a.length;t=a[s-1]}this.video="https://www.youtube.com/embed/".concat(t)}},methods:{getSections:function(){var e=this;l.a.get("/getSectionsByStage/"+this.lessonData.stage).then((function(t){e.sections=t.data.sections}))},getFile:function(e){var t=e.target.files[0];if(!["jpg","jpeg","png","pdf","mp4","mp3","text","avi","3gp","rar","zip","plain"].includes(t.type.split("/")[1])&&t.type.length>0)return alert("صيغة الملف غير مسموح بها");t.size>1e7?alert("حجم الملف أكبر من المسموح به"):(this.file=t.name,this.lessonData.file=t)},handleVideoFileUpload:function(e){this.formData.set("video",e),this.uploadVideo()},uploadVideo:function(){var e=this;if(!this.lessonData.name||!this.lessonData.section||!this.lessonData.stage)return alert("كمل بقيت البيانات وأرفع الفيديو");this.loading=!0;var t=this.edit?"/editVideo/"+this.id:"/uploadVideo";l.a.post(t,this.formData,{onUploadProgress:function(t){var a=Math.floor(t.loaded/t.total*100);e.progress=100===a?0:a}}).then((function(t){e.loading=!1,t.data.done?(e.$store.dispatch("writemessage","تم رفع الدرس بنجاح"),e.id=t.data.id):e.$store.dispatch("writemessage",t.data.err)}))},downloadFile:function(e){var t=this.url+"/downloadFile/"+e;window.open(t,"_blank")}}}),u=c,p=(a("75cd"),a("2877")),v=Object(p["a"])(u,s,i,!1,null,"5158c647",null);t["default"]=v.exports},"75cd":function(e,t,a){"use strict";a("55b0")},a89b:function(e,t,a){},ade3:function(e,t,a){"use strict";function s(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,"a",(function(){return s}))},b680:function(e,t,a){"use strict";var s=a("23e7"),i=a("a691"),n=a("408a"),o=a("1148"),l=a("d039"),r=1..toFixed,d=Math.floor,c=function(e,t,a){return 0===t?a:t%2===1?c(e,t-1,a*e):c(e*e,t/2,a)},u=function(e){var t=0,a=e;while(a>=4096)t+=12,a/=4096;while(a>=2)t+=1,a/=2;return t},p=function(e,t,a){var s=-1,i=a;while(++s<6)i+=t*e[s],e[s]=i%1e7,i=d(i/1e7)},v=function(e,t){var a=6,s=0;while(--a>=0)s+=e[a],e[a]=d(s/t),s=s%t*1e7},f=function(e){var t=6,a="";while(--t>=0)if(""!==a||0===t||0!==e[t]){var s=String(e[t]);a=""===a?s:a+o.call("0",7-s.length)+s}return a},m=r&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!l((function(){r.call({})}));s({target:"Number",proto:!0,forced:m},{toFixed:function(e){var t,a,s,l,r=n(this),d=i(e),m=[0,0,0,0,0,0],h="",g="0";if(d<0||d>20)throw RangeError("Incorrect fraction digits");if(r!=r)return"NaN";if(r<=-1e21||r>=1e21)return String(r);if(r<0&&(h="-",r=-r),r>1e-21)if(t=u(r*c(2,69,1))-69,a=t<0?r*c(2,-t,1):r/c(2,t,1),a*=4503599627370496,t=52-t,t>0){p(m,0,a),s=d;while(s>=7)p(m,1e7,0),s-=7;p(m,c(10,s,1),0),s=t-1;while(s>=23)v(m,1<<23),s-=23;v(m,1<<s),p(m,1,1),v(m,2),g=f(m)}else p(m,0,a),p(m,1<<-t,0),g=f(m)+o.call("0",d);return d>0?(l=g.length,g=h+(l<=d?"0."+o.call("0",d-l)+g:g.slice(0,l-d)+"."+g.slice(l-d))):g=h+g,g}})},bd80:function(e,t,a){"use strict";a.r(t);var s,i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"app"}},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-md-12"},[a("div",{staticClass:"form-group"},[a("label",[e._v("قم برفع فيديو")]),a("input",{ref:"file",staticClass:"form-control",attrs:{type:"file"},on:{change:e.getVideo}})])])]),e.percentage>0?a("div",{staticClass:"progress"},[a("div",{staticClass:"progressbar",style:{width:e.percentage+"%"}},[e._v(" "+e._s(e.percentage)+"% ")])]):e._e(),a("div",{staticClass:"row justify-content-center"},[a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"btn btn-primary w-100",attrs:{disabled:!e.uploadBtnEnabled},on:{click:e.upload}},[e._v(" Upload ")])]),e.resumeBtnEnabled||e.pauseBtnEnabled?a("div",{staticClass:"col-md-4"},[e.resumeBtnEnabled?a("button",{staticClass:"btn btn-success w-100",on:{click:e.resumePause}},[e._v(" resume ")]):e._e(),e.pauseBtnEnabled?a("button",{staticClass:"btn btn-secondary w-100",on:{click:e.resumePause}},[e._v(" pause ")]):e._e()]):e._e(),a("div",{staticClass:"col-md-4"},[a("button",{staticClass:"btn btn-danger w-100",attrs:{disabled:!e.cancelBtnEnabled},on:{click:e.reset}},[e._v(" Cancel ")])])])])},n=[],o=(a("caad"),a("fb6a"),a("b0c0"),a("b680"),a("ac1f"),a("1276"),a("ade3")),l=(a("56d7"),a("bc3a")),r=a.n(l),d=(s={name:"stream-upload-video",props:["fileName","lessonData"],created:function(){},data:function(){return{file:null,chunks:[],uploaded:0,startUpdate:!1,resume:!0}},watch:{formData:function(e){}},filters:{}},Object(o["a"])(s,"watch",{chunks:function(e){e.length>0&&this.startUpdate&&(this.upload(),localStorage.setItem("chunks",JSON.stringify(this.chunks)))}}),Object(o["a"])(s,"computed",{percentage:function(){return this.file?(100*this.uploaded/this.file.size).toFixed(1):0},uploadBtnEnabled:function(){return this.chunks.length>0&&0==this.uploaded},resumeBtnEnabled:function(){return this.chunks.length>0&&!this.resume&&this.uploaded>0},pauseBtnEnabled:function(){return this.chunks.length>0&&this.resume&&this.uploaded>0},cancelBtnEnabled:function(){return this.chunks.length>0&&this.uploaded>0}}),Object(o["a"])(s,"methods",{getVideo:function(e){var t=e.target.files[0],a=t.type.split("/")[1];return["mp4","wav"].includes(a)?t.size>Math.pow(10,9)?alert("حجم الملف تجاوز الحجم المسموح به"):(this.file=t,void this.createChunks()):alert("صيغة الفيديو غير صحيحة")},upload:function(){var e=this;if(0!=this.chunks.length){if(!this.lessonData.name||!this.lessonData.section||!this.lessonData.stage)return alert("كمل بقيت البيانات وأرفع الفيديو");if(this.resume){this.startUpdate=!0;var t=new FormData;t.set("isLast",1==this.chunks.length),t.set("fileName",this.fileName),t.set("chunk",this.chunks[0],this.file.name+".chunk");var a={method:"POST",url:"/uploadVideoByChunks",data:t,headers:{"Content-Type":"application/octet-stream"},onUploadProgress:function(t){e.uploaded+=t.loaded}};r()(a).then((function(t){e.chunks.shift(),t.data.done&&(e.$emit("uploaded",t.data.videoFile),e.reset())})).catch((function(e){return console.log(e)}))}}},createChunks:function(){for(var e=this.file.size,t=10*Math.pow(10,5),a=Math.ceil(e/t),s=0;s<a;s++){var i=this.file.slice(s*t,Math.min(s*t+t,this.file.size),this.file.type);this.chunks.push(i)}},resumePause:function(){this.resume=!this.resume,this.resume&&this.upload()},reset:function(){this.chunks=[],this.file=null,this.uploaded=0,localStorage.removeItem("chunks"),this.resume=!0,this.startUpdate=!1,this.$refs.file.value=""}}),s),c=d,u=(a("0667"),a("2877")),p=Object(u["a"])(c,i,n,!1,null,"57da223a",null);t["default"]=p.exports}}]);
//# sourceMappingURL=chunk-1dab0d62.30569bdd.js.map